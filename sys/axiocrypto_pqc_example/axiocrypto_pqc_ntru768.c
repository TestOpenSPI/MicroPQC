#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>

#include "axiocrypto_pqc.h"
#include "axiocrypto_pqc_example.h"
#include "FreeRTOS.h"
#include "task.h"

/* Provided hex vectors for ntru768 */
static const char *hex_pk_vec[] = {
     "0054A973E3BF8521A5049442D458C8A74732836B61F87ACCD15CD7994750A389A0A684856E7428281B3CC12160CFC395CA061F0BD3AFDBB8823EEB793AD9351AB2C3D536C26029186A50B2AB916F16CCC00823CB0E7743215C2326936B18C1D12A1221695D2D6DA5494CF55F4E0B6B2622026CC824A0B217E204CABFB993A71798A55B21B01C7B18F54ED7BA5BF8C7580D4920C71CBCC28726A915CB6B89CA44111078CC5694982BFF7020C330AE6FF2166C5427F2D7D2BCE4A8CAB90796E97170DAB0BEF8995EB9A98303B1C5C4C1D151289F62D755E138433D3B091A6D2D17B6CDE7A72FEDA2364D5551B96ACF4BB01A83D195EA4840F6A87A03A3389C7E31B47DC79ACC33E3B6B150B4C9FB7BB097523430CB97FB2273467CF36A3AE42B9989288F68186BF9BACFE32BBC314D99AD79542D099FAA78270619171EF316C2F74E212761E7A62ACF83C745F6BDB5D53C2A18A1780358EFF4BCFBA0BCCBE2760DDD84676A05917464C098D34A000423F39A497145683128661D731B103444B9C51CEBAA93D22C40B9267FA58998C09597B04CFBD5AE72B63106152E0E5A5A04229C31129BD6A451CF726AE35C6F90559CA93C12FA876407530C0249ADAE653C2A76A0A570088EC7B7748DC163D2D55E0D42F0401F78099AEFD44B25AA3C49E5A016E4D030952322E02C08CDB2D1C4CB4FB743C97AA043695EA7DC212C25BD7E321CAA40C5C1966CB73818DEB4097CB97DBA574FD5751DF52992F7C663552C95422681930A8F1F6C4DCC680E02ED79D5B9A79768711B22358184BC38968D36B3376A2D64F7739C7CC180930BBEA5A75E140C7A5D35A4055380C6601609748DBFFB3F99024ADDAB6052717FACD90064743419C13E7AD78EA5047E0D7D30BC7B33AAF6745EA915995CB2DE998498A018951ACDF2337B95FA9E3E412F3E21299FD04D6C7609126281D2A4B274D8D665D26A4718AF37222015A314291DB2EC5B836201B9BAB05ED110B2CF63256EA84A228A58F83C60BB412F616444EEBC52384A126D537CBB937E5DB8535BB82291088A5D0325336069ECE4B94ED8569BFABA8F233724D22A707189F1E24FD635D2F31B74FF8B378FC68E19524FF1540ABCB7C88F1B4917DD22DFE818D93CB66A1AB1E75C380A649A6FBD9EB442182CA94196FC9F1B9D018D3649E8AB361D87A7EFA49C87923BDCB82920869FF4DC6AA8E79FD3D26D0010131C9B75049DC917BA65645944495B152E096C3D39D0A6243237746D90D219B6106BF1185E4875702206A3180D92915CD0AB9081BD040C381581F3545EDF56C086C057A357931789B7CAC84377030C353A5D387C4FD6A08A3ED53379487859F19F207A5080A81362AD75FDDBA7B367B022E7889B2A91FC40C53FE99293D58F2A127E9EA62529E1620F6A436EAD87FF04AE1A311B5883842FEBD147895822CA9AA9B1443E35AC87695175B2BF136248877685252BBFD512033DA780FC2AD4D666D0034161359264C4E70E33186BB643C41523B920C11C4D0202FBF55E9F64AB6765D4C012408531CB9F01C5CCE3D08FD742B672994F0305E833213608617776203FB11C5DA9A9F832422B890D7BB33E4D44786EE9B26481D525599E51557E",
     "3DA04B3C315DD4B7081E7932B122BC6653A5593972B7AB2EC39665CF0BC49BE259975B895A06C2043D230F31A6BF035D4C157F169A06C4972285D67971D8D107A04F98B91BCA51198261037C63B3E53B834D733414213ECBB0B258B7CC86EA9F00023403A00A6AB565E3FB2157F2C4278D37C6D10F56D38ABAEA8DE5F6B2BF929B380BA2266265B859BE34C4C5D11C85D8B74609BD8C6969A1925C014BB77749E134E5A76F42EBB69DF6AA82ACCD8E537BE77899322DBB176C492DA910B1704151CA9D37582D68A36A739553B8FA5983CA1FA54B66335585EA8A1D3A7320496663C0E113CE324493A47B3A7493E0C8ACA4E6877231578351B9D9A1BF4B4DD25FCD3A5F1342516D40935AB6640DA9915B24E4292E11D84F56302D4F0097E6E1BF02993BE3D160734CA542CCD00CA97B93D2173EC0C1F09C83D7C36E831B6A4AF63A2F6C71621CBFE071658467A2694C17531947202C6636BB6D67BACAC95CB4195C08FF2A2C1BB87FF1206D35E959E9AC87553C1E0A731EAA90249E998634537CBB8C037556D7A8E2D781C65AD01756E312001EDD06BC925B70623A8AE4BC5A0DD2355AD5BA190B69F751BFF3756DD4B870EBA23C20745E4CC6DE6261F7139A1E7474260BC1ABF1CC877A53C07B1B40F337FC878414E5CE7EBA2F3FF8C09FBC092E7C4F6485D5057D383DD855D4C72E7B32D3C97A78DD60B2E9C86CFD6974EC2C3471843C0F117B7D397AD4F19350A29E171866F56B44912C83B7E8080B1C82E256187BDB4C7E987A609A0250976A3B8BCFD240BD1AE701B9E193D4AA463765C6452C6C9513B14C794FE83A67190B3008D1A5391B45075163387D5C46C4A3E662B6CAF18FE0252D2FF2999FB80731B3C74D4570443354D3D7AE89F90CD597A21EA4B3DD08839803B47DEDCC5F760710C640A53376FA26414C54B3C86C5DBD19416DB45DB817C91F94C16477567EA24DC0D694FEAC0376DB8B9811C0AE87585CF77E84BCAD11EC751C2D0E2AF3C04514CF9FB90B8D3C5A8E31AC2DF73175A9055CCB8582A421FDA413D7A8328FF748E162D24FA6A0755545BC49D1745A096240A15C13B0CB2C0FC9F6605161BC1744915A328328E555BA608D43ADC4A42648638BD703A775E4781E7AD48DCB6C3C88F52921B9302C45BF7F668B732D8D5BC76953D4272D6D98FE60CC34E55FF00BB571309558F35249DD766765A012B40EFFB63ED284939470A7188000E5FA7193D76B0D04348294680BB6CA957602BAB2556CE3C6C8392711CD5EB2EA9939A483C5020E3638D08A1BD3A2C85B5346631DA57B54B60D6552331071843D287330200EB46890F94BA50ED43B65B97E84E4A3F8F53F8924B2290B5BA31A422CF66A75901A587DD4D1B48613ECAD7CE638656348B1027C21A8620A0CB65A617BBD7102C1BA1FF0B86B00DDA8D9BB6BCD023B1BA90EE8244A35872FD079200C678394D26A2565B80E6356E57B4F5420023097C010187030D07FC56BC54AA20CA3096B9F19377CF7813936B56031C71AF4662BDDCFB500BCD21C097C57104EF60773705EBBF43CC05BAADEC6B2981812E73AD7FA2C2F63286993358DE2161E51591E0DE58EB4008024367BFB4A0946A70D07A2CF98D430"
};

static const char *hex_sk_vec[] = {
     "B3EAB22A0676D26B867D2561C322ACE7A7C9F0C3D180B90398A19792B04DD483A0D9FB5D61C5BE80697A964737C1310CAE9C8CB768C8C073A0DD206E58298007DB4503C7C7D67C2AA36ABA8CA633CD05883672AAE398BD1FE156B308A4C28437E709297F3DB58DB94B71F9D22559509EEBAEDB4839A062259AE848ED99480B019D1B02C69E133BCA46CEE5E253F55B1C81019917BAB9825A7519509FE6886E6F301F31E487B345CC559C59715DA4932B2090B33F269C314A6607C3EA22469A1C42F13276C07C2AB7A43F3B28A62AB41E9C95DCD3A5DB55385F203276C4B1272D1414249213AD2A7121202F7B56BF2729E4C71BAC2809905B1450B4505CB3B780FD40500A08C779883F4B635CDAACD8D11E169DCE7DE55D01A199B6487194A4CF68CD929EEBB29E03867FF458F046AF0EF43DA72B0272C12A60659C05407F8C33881F99565A7345E248D212CD580B437341636DC81C3F8BEBB4F4B6CF831CD23D5C0171D5B6EE2A0DC2D228C2398859ECA8AEE028AC079774324B3EB66D39303806FA7B3E029AC942CA452A5F8F3C61C45C8A3E264816B60036E4AE9FBB5FA709D8EE241EA68A9357E6151E734D98998EB7B2AB892A1CF846AA1CDD2A5763A1F2A87F50CB451DB0CE4E58A07C994F7FBD5EA7FAD34FCC7C38B6255D206B4BEB218418A421F8B381E8A334C20A79569590E48477DDC328D8592D218357BBD346334E613412AEEB6F3AD16A78504847851DD640A6782A7B30B01000D6753F75D1F3139EA47357105595CD774BD96A779F260555A9CC4D6695F9A88EEC61A32DEC8CC04C386CCB5F89139068D4013C6D73CE011A216170C52B0BE263C12723A3427C9009BAA2584DA15657AC4015D4B8276144E43DFDB46891C2BDB602AF2802534F50A420086F3680A832F47DB4500A17BAB9803D372D2BC1A442B277DA15483365E15314AD719129F2D2EA632B0EC7ABE8046D26ADD707EB13D7A1C0DD91A51DA2AF10601C90A3CF765C51F75218CBA227AD622AE075B1D9221D33A16C60B92E13B6597EDD6910F507CE12C0BA531022C905644A269CC7507CA827E5E99993F85560718DF2FA7BA3226C4A007BC035A30D918AE81B36C36B20EB9B0071E339C36544F989680CA3CC5B45782F272C650408C12AAE1922BEB66A3B0A4B95785362129323149697D672AF744A53335B6AA927014369710ED246B9D220BA25D2BAD7C932F07EA0B228572B7A077926DC683ACB691C1F9D1400C07A8A933CE0649237B24DA2B150AC768C95B5BCAB9106D94635C0961E9266AF029B70823A431B6189036DD05D63036F75A0E8B90A9F45675E96B315F49A4AA23C062087790C099AB5BF067629318ACA15D0294DF5643738C548767C6D82A77567618C310E4DED218D3A98BE4247C7218EB3A746A68B40ACF69758A68FF787370E48CBAA229659E00F09A858110DA4DFEB1D6A19D4CA56AFBF33A4BD1825DBB94873C94D0070271883645BF319719B5514884E85C890CC6C199EDC703558B3AEFB90842479FAF613C4AB9820D530172D0A2ECC0A5E1116B4554C36CCBE046B771C985579577BD91C10679DC79D85381BD29F9E7463D105892BB3B5C788AC96AB826B8598AE9C0054BDAA4EF9551CD3CCA802A79A59A1632CBAF17A24E94382F4F3296BF7139331B6CAC80534C2BC06D3594E83C4484C9248680D82B34570F37744384F4164006E31B60AB75FA9708F9C1A381F58B39E28D342CCA586497757F4CF5619AC50F36BF602CA03FD1CCF4662282903C822BBF5493204FB772C8D4A5063403F22AB56FCCD47EA494483128BE9958A3A2B2535A7392055356D3CDFE8424F25888859C22A0C44D54302434D55D2E6390790AFA58621B3C8BD775170445C07B983ACB317520D3104A1A7360B746EDC94152FD709633A37EC7835E1D15A0197393EEDC89A57108EFA5169AB3D176BB980E2B3FF4782F4554ACA944FAC74C9FF1353173062C87A19B76310FF7C0AC08A5D1107AACF55787BC1019C22AD10DDA78A6687DD0806F4E101B7E698A64877CF96C6F7A346B013182C094413038789B8D23DBD171A68CB0E07A9C6915C556A6F4413969C35CD6DBD7958FBBA3A469261B0AEBC94D4D5E10AF4E507621C1F1594980B11D48677C4B28012A44817A9353DCE2A32FD6847E84389CEAA400B10AA0909CAC0AA85A628399514B2529473755246FFB9CDB0DB4EFD5A347EA89D00AA33F7F23F4250BF3C1561AAB9551853ADB71637EDD58B9D33D191BB8FAEF594B6FAC94C9396EC13665B888DA59C58D47BB167B3A8F7630A5E087345BA1F9FD29E25E0823735AE4BD9A90D98357C1414EAB98C1FE1BDABC1CA578795E6AC8D18F602DE25926785CFCF139CD3D0AB38FAA999F0B2C15B45AD893E39CA2959F8A4F0B102DA6298506B8C64E9ADF5C840BAE0C43F11585D3253A2E560F99A64310AB5DE876C29839586330AFE416DA7975C3F4C78BCDB393F2006C1E57B8AD2052FE8BD87A4392A3B287491262B96394C8535E4E3CFD8217C04265B3C3B418A03C5D2546E6A69025CFC3CC9A9C693079E92D356C6F0827B9569CB1BA6A9F30CAF6A4DFFE415FEAAB3CB33B0E7A72244357895E771A1FC460431B18DD3BCFE35472062CEC54359207A8BD21A5AB681C2A7D536ADC8717E91CDB44A44F1E228702047177CCF23650D1B7C4BA0867082C58F3DB4C31FBB7538F33A590B7F97D79148E3C2120BADEE6C2BC4984A1791C4E809576BE3C913F3639E411596ABA923510B5724CADE57120C564684857A35290A8A57B09B2B3DE1766E5C8B463072200AF74758362E7E608EC668BB1EA43582D32D5852005F31339E85C40E76B212807E12E6A401A06AFB06496BD40F3B59D188E0485B92A47B56B1C913CDC887BDD9084B4B6D5329FC42D0508F2F6237EB2B9ADF7454697158D9B3279EDC23F34A72BA24678B51AD8E30313608348D82A73825427DE509A162885FA4BA4AD838CE386B399A6158151D84465A4D1A984ED79E0ECCA93A174F267A688B9BBD3BA788C6F9A956F36A7AA8237F76061B4CD7DE859F6248B9039B0735A00CBF1474B1353F6ECD5C23669B11C6367F28C3F85B5236AC3C2D6C983B907062CB712BD658C5A12829727E3FD8759EF99BD9684868D58DA1D0D3CD0175EE40640F9082E2B83C370C61CBDA82794C2984ABB63B1DD4779A3F644596659789761A6065105DBAD0A03AA10CF80B906B577A187BB65B442423856225792E560B0A75D4096661B70054A973E3BF8521A5049442D458C8A74732836B61F87ACCD15CD7994750A389A0",
     "06619BA2C94085E9B80D3A01B06A4B67604B5B456032200BFD3A2B9664C42562011071907C7193BA824A89E7C53E960430A8CAD4069D72386CF20B6E5CDB2E1F4388D1A61AC84C4D04C2D10D20CCD87BB95E227922A51778D0CA5C4A994A7B809957A03C47C5A3B5881DF13D0C0876B586906353AE65EC48DA78C75196A46CC286355952930128D1551D213C6A77422133C03D4B7CA8ACC48FB06604AC1206EDB5BAD2141DD7F3192C55C9F1A8B40C6D92F4E7BC39ED2259745A6BF433B23B46558C23DBBAD55C01AB7C8AB89AAB4624E281E4347434A0379F5AA7CF81C20D6A0F14BBA3DD514D3CC910CB05499E02033563CF27FD3462BACF535055924B650484668406D0CBFB9FC5A718833B891ECD98FAB46A3F914F4826B7FEA2C0C7B5D22AACB53D6AC493F91B67A56AE80564831C6B60AA7C65701E564D3770DA1B814348EA8401B2225EED990982D58406DBAB500508D9D5292C891126FB3B0D08D3D37391AC3A6A6A03252DE981CE7B5102EDB2CE122FC705A5C3A2691D46B75A798DFC6A5923B07EF4F0763393672D34CDFBB639CB0C37DDF0BB909104A22A5FC6A5A7D21BA6979A7CB6F8648C95140741186812BA54D88FF8FC286172B8381142FAB56DAC8C0B188BB74C979463177617395381A85AC5D2BE9DA77839328F71330A48B769256A3E81EB118F9492CF43567F320DEC9C9CE7D4AA312AA004C8588B2AA0EDBB911E64C4DEB88B4FBDB0F5F6D67D13BCB0D4C0DA1480557D458706C9C149BE2A77B75B8814F75BCA42C037A5D77DC0457D982B917BF413988144FBD08954A9285BC5D3CBD754A08093DF01C0C1B5A442654BD844D44B33B57D8686F6B19C04FD77D6954D6C8355B46331A092B8CFC81E9E882284D752615557F7A81BD7E76C560AAB10733579F2D0777A74D0B3A0B9269DF0262DB2F2AC7AA9D12918C57AF0B10C815A9184CBD3A8402E315B059226ABAB61282BC7FAD0836E9B8CFC7B1C97386B10918BDE8A458DF31CF3767D8DE6D47E7A363693BC30674552408EA6D4B3825B40E4301F7598C3443A6226C610C53C1AE36B77890700C54AA9F841141C5BC4ADA072F6244F87E74D6B814ED5D53F5B90747B7251E7C87742AB735BA130DEA779E4DC1DA2505D0FB8BF0BB668AB596D61ECD5A7B711C1C15114C32E39485FC8184CB71845EB590819F0680C596C82874E5CE6A11B5501E7F1368C31B825DA66B5888CC2A2054243BA84B14994D74F583528626086A104697EFC23D3CB4B1519C482A214781C415C318C8EE2CDF5B32A8FD881DDF7940A084D115D080595860DFCA061671896399ABBF46B4DE1504E2232F6DC97047763A42714083305E5C0B9EF79A0D2776092C981ECEB651DA55318665B7212A34B66D4104556CDD474D00C19396C93028D520F8708021B3337D166B7976EFF656A2106B16CF3041C81815D525B6F95B646A1CC899121153780F0C95FA06A842B9454152DBC80084DCEF8310130C75A2970F63B3FFE0750587A28868544F5FA48F654AB6911A7B8B12B43D13A486A001F649F56CA0E0CE57FA97A3CC365C04855C6326562BEB03E49147C7B1A53DDFB79E3D332D66A5A24EB2B6C128E6625600FC7B90FD615D6C07F49DD97AFF100AE524BAA98249E8664651CABC6D1A748F81AB80379B7D9A42C8922A09CC26DCC022E04CF3B68047DD9C696EC6810C932A9292C6AC0377CE47B50376F867A89C6291E3DF290E072BD37992C8890BED1B6C84DE68EC94663631127AB06648CC29287FC5566912B6633C29F430106B771965CBC94493AE3645CBB807A02C5005FD974A352ABAED1430DC9932648A64E26B49F09242E578314C915257D5B96E56E59A00BDB8BA07D313C0B318A0C458698831CEEC560849CA7DF069C3F705BBB4326B7D2698D067CD044CEF2C585C4FBA98E26A81DA5973D8D31EFA81816325D146A781C252F4A770F85024CD82395D7C8574CFC6576862EBB237042F2197985B2D4B169C3455B9FC366EE1412C2DB8B75CB4D26F6C43071C21B35B59CB2BC541C55B1A79403417FC185A2764522FA0645619A0E1A78251B06029E0C5D626762BD84897A780A1B71C897D74BD5A56F993030AC0553FC457BBB841764171277A793D7E94867953E3CD2978660ACDAA6474C7C0B50093BA9196311CA88FF054DA235B4CFD3A417F548686CA15DA5443942304D47C5549B6908F09583140F1C41D5FC403DA0C15BA61C0FBB9550C4815F8CA24F1081BDEA60BD162DCAE44418D0020475B1BA1CAA3C0C9AA54DC990D52C75491CB1D296210855A461954A16D68D02387E051B7635AB78677C7194D54F82B7C6EE59C21CCC95759BC787E76EF3F55E7954D258F79A06226208A1A1D3892E6BB5A53598CA7CD23F47411AEDC00E94C544FE4418CDE443DDA080FB07436286BF48C3916ED9481C1C0EA972B247B92C3C3A3A4146A95D147FB786CE4FD5A7E0D4AB4AA47958B3651235C340A55C9508B1EEE89E7E7D51E69B9E1B411FD6B1B38A05D2708BC3C2881FBE221F3D6C790D0905BBA2284C950770A775C6677026325D3BA9BEB19A7FA09567D3E9025CACAF50E736D31476E132C547A46A3B64825B638DE6776F63FD168D45633FD644A7C8063A8421D168B08122B93449420A0DA9ADE6B74A940D60EB0F5B0B6CE507D3D107304315A372F7C55E98949FAB889050A5FAB73318666A45C03E71839EFCD304A421D056C65252613633DBD06174B17AE0B819A90E42246A1E3BA38CC48F3A9152E3A93DEC90165E225DA3A73BC2E36419E82D47017E3DF537155A52F7060E9D08BD18427B582010C99C3FB65486800284D7804124ED19C4EA7A57A06647A8061B171B0450281114497A1933C569CD3A295B83A54B2C13D1966A54C6086B0E84A8F9804C98035D3115389065AB08B3735AD6860AE93478C25B77FA3288AB097F128F689A1F3B214271E89CA1B998D8744F41EA5C457A568394A552464463CA7313036524E43E87641D9C53C6A4E61075C62190AA90565C119A063D43B1CE9F90B3C1A0BBD8738988653F44D55318914B61127779471EEF4316D3D33EF137B2F1B852245216B7452C8846B1A77C00B1EC3C8C70C62B166C02E69D5041628B60810B9C1297A582DEE93878D16008AA07C6AC24DB26898E1488CFD06367E6062FBC2968905D4BA894A3B8A4CAFC49ABBA815D9BB972D5D2CD52A1E29B595010AC8C5C2346B7086B41481A087841D49CC1848BD05AA8D7B4C27949397E61AD3DA04B3C315DD4B7081E7932B122BC6653A5593972B7AB2EC39665CF0BC49BE259"
};

static const char *hex_ct_vec[] = {
     "31628C68B1BACAC25B01059A0A6A20C65385BCA6CFB0BACDAB03621A8A5F276D57D6C0D1BFA528F4ECD7BA2214AD6541F6653FE5AC574F779742556C574C3F8E625E7BE70148CB02D7D126A7F1356425A2BAE5D7DF6631DC86B891772FABE839B20CBFEF928FFFA244D469681220630F640A14944DF14CD4D536CD69784FBBB06C04E91AB40C1B04D7C2D40B3F319B9CCB601CAA60358CB4D14E500E0E2BD7328DB4E39A2B034D72603B6E39B362B2642934E19C6422C72D40C9E052C139186BDBA205A81A13F323665BD86DCC53A809D9CE32EA1F96CCA0B6A133B6EBA261D7171BB9769F691320F6CB8A859628D3902BC00A8CF49ED3D53952DA1D8AF611A161B026E4C084ACBF43860024ED1ABDF787396A2B6EF4812B3BA384492F1D6419898999FFC5C4EB93AB3BAB8F6B4147C6B88F41BC06840295CC855341BA53D8C67E06B9B989F27D11C8BB7928D2A796D43C8D1B01481EB82B8FB712CF73563806695C80C50690128277A4173DBC868818534751B3317CD2C6EC886AE07FB9BC7DD42031C0F6C86F3219BFDC62CC14D776E4014BC8682F01017D27CD7C7AC6D4B5C56C6DD23EA8BD4E969111AD3D9E295C6D2BB9F4270AE474C1428A1CF533038F9961EAD35FC88862AD8762B55302BAD33B54E88E0D8018AE327D01B3221719C730D747145BC774D14588A88D09ABC53A09228339295A801E8FDBBCC863D3C46951588C0D48ADB454A2D7D9DAA1CCCC7D73B7345CB66385434B41AA2672CCAFFCB008A713AC31814F14C713D600D55E6ACE81633DB0B515F22059397D11E95ACD9CF0BF71AB440532BBCAACB54B6C407CE66B466D60E82649275AD7A767871297D71E70A6CCFA33E9F2283044679B941A9C76AB64C8A1D12496A47BACF358B23373B79DA2BE0B1537BBE2D4B729A0C3E9A110EA024958ACF7FA793B549A2EA488784328A479A921A3B839AC2FF2203FE5D47EDBA14FD3D9225A1B1A298DC1EFD821D97866D4081F31AA4528DCBF9C87677139845495CCC72095A810063EA6925161D3E775D122A10A4EC193F390CF6F17060E5AD4F4C73822765220AB8738132551F2B50D180FB5A1324392A4E672BD5C98595169665C57181CCA5EB0836E5754D420C02BBF69BBAA1B3517F573DF31AB430710FD7142FED0C5B724536FC44EE3325937B1241F136DDB5B5767187A3B610C7A545FE7BA2E9AF636583577BE42D68CCAB020F299301C2C17ECCE1E64B3F7E4650C6430341890DBC80862962CD14B778CD3C27A2DA5E10199DDE0A98EF5444F96D11C0CA2ABC3D01E01135E4A7D011428664AD4CCF18A8117CFA8EB0582457FE9A5D1AB5A9DE885AD2F02CAE3E165EF37670413757118A67B5C391DC3100B7029BE0813070D17566931D53CCEE59428A3D5BD60D7836A867799A72A34AB352649C68DE325B87AC2F7204AAE601A254A861AD3AA148C1355ACC81AF37C48FA7DC43BD216D708C8B1149583A0F8582AE01B9A8214103821CC6A00241516675F489E60CCCCB2B18FF4270A9322B46D5D175D047DBB22739AD451F2D27068FB8D4E0B11326B5FD178D54E685238C2911CA7B2EC663C6C9D96519B1F54ECAC0F9C0086EC5EF3215317C2492B916461EC91",
     "B13841A840B6296B6854803C27BB1F9B79B5ECE0BE5AAAD56730746B95A048A1A47D518E3B38914204C292994CC6F7281BB41FD42B6AAA9825DD4737085661878864FAEB84A7F8230D068AF816261D5D959353611FD318E61A3B3F1A9CBE795B04DB0B18926A110B29A2C094122C2194F03EFAF1714C539DFC204338849BEB73197A9754DD614FD99CB21A3C49B3946EE39C252C7DA6E9E1C6E94537BFC14959464C0FF945F4151A7E88B26F8CAF10D044B812B6C291D6BF9418738C86227A7AE2451C71324953D61C663D338087A0C004059FEBC722E53B1656D62091634D96358553BCE0166696819EC0AAAE00941747294AA4F153ADDB10CA98A09E22C82ADD0CDF562878082F9B60636CFAA2F53184A7B742F4466B233C8809CC5861C92360F6A0D1152338636F2969276EA5700C7D376136525FB81E6D77821EF751FA755D8E997A1576CCF62977BA6483B4978AA48757024D4B95EB7D9BD610A2B84F54D642D3C34D7407C05FF8CC3DA7D18A32D5535025DCC492678635678677A5EB068CE8567308845AC55D07C10931508D8856A54DCD01C5123732203882DBCAD2235F7D3BB64F7804236D47D6A636A3D836D5EA47D73C486B74C3B36A23B6A4D523758406E9405C50607EC12EDD345D8C5C693E2D65E8604BDC993EAF64CB54A36D7EFAC00484D476CA1307EC64680608C5F13C41592C38D96B0A001236834E06FD7CD6F3C33A796A44476519D25ED30A3EE5CA4C86252D66B84DEB1AD677AC93239C49403DD21AA6B53E6A079B2A8E5A89B175F428F1DB5B135475E675CC5DF2CA6DE00A68BC7A29F0D637278D117BB7F638BF4216133D81C9E0F6A75197C5D5050830C3B6A31BC04EED0CF138ADC50069752A6114D665237D2B4A129145EC8EDF253DB1C4A7404B55024443D5E5518FA81B8E15AE03C24368F931CAB516DE814620AAADA09B42A7E5D573483E7D7CCD46EC0C6988A85FD8275881C2ACDC92E10BBFF373D10BAA4E436C1583FA4658CA1A26D5C7F8651E7AA01F16DD8C577D443EC1B598237B04D6CC6437112194D146222F5F3D2C02F26C7E04C1D5D232A3A9188C19632F08428514987F87BC7246B5C082ABBF66BCF091C543BA566DC15630C35E4B11B0B70BBCD773CA98F41395345843BB02C1796A92B26FD27B85F818604B38AC6EF368ECDB5D38610E53F17915725FB8A44365D4D646DDCE7B740F144D8D709D9AB3DB303CE848A84C345EEA62996B375156C0D50941749500A8E795CB3A99E4D9BA84C13A871C5BA3D11F847BAC289193D44CAF14B1BC45D69C7B8191B3E9C294E76B1F41B090960B0E033DB3710E073B6695B47F92D83400DD972506697179B0DD281D8D73614FB77A34AD14A4CBBB0C3871D3442681B8D789CAB1A3218A1EC704D4A04D5202AB8E35C1E6F0D4139014CE16AD0BC160BB0A3272B068302DD1C85CCE28FB44785135C78A9E1D7499CE04AF3E4AC9099D8BD495C8DFC75B38F41820B3B59202152AB6B96DB3832E919B4CAD33159229B185991A3D7E4D909E3B8A5DC1582A18D5A458A7CC679DADADD88F6FC290EF768287E6C95865B1D522990BC96319B8B3EDDC85A69C5FA379943A5CC0DF379B0B61D5B56258CE0189"
};

static const char *hex_ss_vec[] = {
     "7A380286FA266E3934B2A0164D6915FC1E436775D3505379AAD4DFE69C19B0DF",
     "83D23B7B4ADAD1B71BD1A71DA30DBF8EE7D1704204B0AADA3AA82BAF463EC45B"
};

int axiocrypto_pqc_ntru768_kat(void)
{
     int ret = -1;
     size_t i = 0;
     size_t failures = 0;

     const size_t n_pk = ARRAY_LEN(hex_pk_vec);
     const size_t n_sk = ARRAY_LEN(hex_sk_vec);
     const size_t n_ct = ARRAY_LEN(hex_ct_vec);
     const size_t n_ss = ARRAY_LEN(hex_ss_vec);

     uint8_t *pk = NULL, *sk = NULL, *ct = NULL, *ss = NULL;
     uint8_t *ss_out = NULL, *decap_ss = NULL, *encap_ct = NULL;

     size_t encap_ct_len = 0;
     size_t decap_ss_len = 0;

     printf("================================================================================\n");
     /* 배열 정합성 체크 */
     if (n_pk == 0 || n_pk != n_sk || n_pk != n_ct || n_pk != n_ss) {
          printf("FAIL [INIT] vector count mismatch: pk=%u sk=%u ct=%u ss=%u\n",
                    n_pk, n_sk, n_ct, n_ss);
          return -1;
     }

     pk = (uint8_t*)malloc(PQC_NTRU768_PUBLICKEY_SIZE);
     if(pk == NULL) {
          printf("FAIL [INIT] pk malloc failed\n");
          ret = -1;
          goto cleanup;
     }
     sk = (uint8_t*)malloc(PQC_NTRU768_SECRETKEY_SIZE);
     if(sk == NULL) {
          printf("FAIL [INIT] sk malloc failed\n");
          ret = -1;
          goto cleanup;
     }
     ct = (uint8_t*)malloc(PQC_NTRU768_CIPHERTEXT_SIZE);
     if(ct == NULL) {
          printf("FAIL [INIT] ct malloc failed\n");
          ret = -1;
          goto cleanup;
     }
     ss = (uint8_t*)malloc(PQC_NTRU768_SHAREDSECRET_SIZE);
     if(ss == NULL) {
          printf("FAIL [INIT] ss malloc failed\n");
          ret = -1;
          goto cleanup;
     }
     ss_out  = (uint8_t*)malloc(PQC_NTRU768_SHAREDSECRET_SIZE);
     if(ss_out == NULL) {
          printf("FAIL [INIT] ss_out malloc failed\n");
          ret = -1;
          goto cleanup;
     }
     encap_ct= (uint8_t*)malloc(PQC_NTRU768_CIPHERTEXT_SIZE);
     if(encap_ct == NULL) {
          printf("FAIL [INIT] encap_ct malloc failed\n");
          ret = -1;
          goto cleanup;
     }
     decap_ss= (uint8_t*)malloc(PQC_NTRU768_SHAREDSECRET_SIZE);
     if(decap_ss == NULL) {
          printf("FAIL [INIT] decap_ss malloc failed\n");
          ret = -1;
          goto cleanup;
     }

     for (i = 0; i < n_pk; i++) {
          /* 출력버퍼 초기화 */
          memset(ss_out,   0, PQC_NTRU768_SHAREDSECRET_SIZE);
          memset(decap_ss, 0, PQC_NTRU768_SHAREDSECRET_SIZE);
          memset(encap_ct, 0, PQC_NTRU768_CIPHERTEXT_SIZE);

          /* 벡터 파싱 */
          if (hexTobin(hex_pk_vec[i], pk, PQC_NTRU768_PUBLICKEY_SIZE) != (int)PQC_NTRU768_PUBLICKEY_SIZE) {
               printf("FAIL [#%02u][INIT] pk hex parse/size mismatch\n", i);
               failures++;
               continue;
          }
          if (hexTobin(hex_sk_vec[i], sk, PQC_NTRU768_SECRETKEY_SIZE) != (int)PQC_NTRU768_SECRETKEY_SIZE) {
               printf("FAIL [#%02u][INIT] sk hex parse/size mismatch\n", i);
               failures++;
               continue;
          }
          if (hexTobin(hex_ct_vec[i], ct, PQC_NTRU768_CIPHERTEXT_SIZE) != (int)PQC_NTRU768_CIPHERTEXT_SIZE) {
               printf("FAIL [#%02u][INIT] ct hex parse/size mismatch\n", i);
               failures++;
               continue;
          }
          if (hexTobin(hex_ss_vec[i], ss, PQC_NTRU768_SHAREDSECRET_SIZE) != (int)PQC_NTRU768_SHAREDSECRET_SIZE) {
               printf("FAIL [#%02u][INIT] ss hex parse/size mismatch\n", i);
               failures++;
               continue;
          }

          /* [VEC] decap(sk_vec, ct_vec) == ss_vec */
          printf("[#%02u][VEC] decapsulate(provided SK, provided CT) matches provided SS........", i);

          decap_ss_len = PQC_NTRU768_SHAREDSECRET_SIZE;
          ret = axiocrypto_pqc_decapsulate(PQC_NTRU768,
                                             sk, PQC_NTRU768_SECRETKEY_SIZE,
                                             ct, PQC_NTRU768_CIPHERTEXT_SIZE,
                                             decap_ss, &decap_ss_len);
          if (ret != PQC_SUCCESS) {
               printf("FAIL (decap ret=%d)\n", ret);
               failures++;
               continue;
          }
          if (decap_ss_len != PQC_NTRU768_SHAREDSECRET_SIZE ||
               memcmp(decap_ss, ss, PQC_NTRU768_SHAREDSECRET_SIZE) != 0) {
               printf("FAIL (ss mismatch)\n");
               failures++;
               continue;
          }
          printf("PASS\n");

          /* [RT] encap(pk_vec) -> decap(sk_vec) round-trip */
          printf("[#%02u][RT ] encapsulate(provided PK) then decapsulate(provided SK) matches...", i);

          encap_ct_len = PQC_NTRU768_CIPHERTEXT_SIZE;
          ret = axiocrypto_pqc_encapsulate(PQC_NTRU768,
                                             pk, PQC_NTRU768_PUBLICKEY_SIZE,
                                             encap_ct, &encap_ct_len,
                                             ss_out, PQC_NTRU768_SHAREDSECRET_SIZE);
          if (ret != PQC_SUCCESS) {
               printf("FAIL (encap ret=%d)\n", ret);
               failures++;
               continue;
          }
          if (encap_ct_len != PQC_NTRU768_CIPHERTEXT_SIZE) {
               printf("FAIL (ctlen mismatch: got %u)\n", encap_ct_len);
               failures++;
               continue;
          }

          decap_ss_len = PQC_NTRU768_SHAREDSECRET_SIZE;
          ret = axiocrypto_pqc_decapsulate(PQC_NTRU768,
                                             sk, PQC_NTRU768_SECRETKEY_SIZE,
                                             encap_ct, encap_ct_len,
                                             decap_ss, &decap_ss_len);
          if (ret != PQC_SUCCESS) {
               printf("FAIL (decap ret=%d)\n", ret);
               failures++;
               continue;
          }
          if (decap_ss_len != PQC_NTRU768_SHAREDSECRET_SIZE ||
               memcmp(decap_ss, ss_out, PQC_NTRU768_SHAREDSECRET_SIZE) != 0) {
               printf("FAIL (round-trip ss mismatch)\n");
               failures++;
               continue;
          }
          printf("PASS\n");
     }

     if (failures == 0) {
          printf("RESULT: SUCCESS (%u/%u passed)\n", n_pk, n_pk);
          ret = 0;
     } else {
          printf("RESULT: FAILED (%u/%u failed)\n", failures, n_pk);
          ret = -1;
     }
     printf("================================================================================\n\n");

cleanup:
     if (pk) free(pk);
     if (sk) free(sk);
     if (ct) free(ct);
     if (ss) free(ss);
     if (ss_out) free(ss_out);
     if (decap_ss) free(decap_ss);
     if (encap_ct) free(encap_ct);

     return ret;
}

void axiocrypto_pqc_ntru768_bench()
{
     int ret = 0;
     int i = 0;

     uint8_t sk[PQC_NTRU768_SECRETKEY_SIZE] = {0x00,};
     size_t sklen = PQC_NTRU768_SECRETKEY_SIZE;
     uint8_t pk[PQC_NTRU768_PUBLICKEY_SIZE] = {0x00,};
     size_t pklen = PQC_NTRU768_PUBLICKEY_SIZE;
     uint8_t ct[PQC_NTRU768_CIPHERTEXT_SIZE] = {0x00,};
     size_t ctlen = PQC_NTRU768_CIPHERTEXT_SIZE;
     uint8_t ss1[PQC_NTRU768_SHAREDSECRET_SIZE] = {0x00,};
     size_t ss1len = PQC_NTRU768_SHAREDSECRET_SIZE;
     uint8_t ss2[PQC_NTRU768_SHAREDSECRET_SIZE] = {0x00,};
     size_t ss2len = PQC_NTRU768_SHAREDSECRET_SIZE;

     TickType_t s, e;

     printf("(op=%d)\n", NTESTS);
     printf("============================================================\n");
     secure_stack_init();
     s = xTaskGetTickCount();
     for(i = 0; i < NTESTS; i++){
          ret = axiocrypto_pqc_keypair(PQC_NTRU768, pk, pklen, sk, sklen);
          if(ret != PQC_SUCCESS){
               printf("NTRU768 keypair generation failed(ret:%d)\n", ret);
               return;
          }
     }
     e = xTaskGetTickCount();
     printf("KeyGen:\t");
     print_elapsed_ms_ticks(s, e, NTESTS);
     printf(" | ");
     secure_stack_disp();

     secure_stack_init();
     s = xTaskGetTickCount();
     for(i = 0; i < NTESTS; i++){
          ctlen = PQC_NTRU768_CIPHERTEXT_SIZE;
          ret = axiocrypto_pqc_encapsulate(PQC_NTRU768, pk, pklen, ct, &ctlen, ss1, ss1len);
          if(ret != PQC_SUCCESS){
               printf("NTRU768 encapsulation failed(ret:%d)\n", ret);
               return;
          }
     }
     e = xTaskGetTickCount();
     printf("Encap:\t");
     print_elapsed_ms_ticks(s, e, NTESTS);
     printf(" | ");
     secure_stack_disp();

     secure_stack_init();
     s = xTaskGetTickCount();
     for(i = 0; i < NTESTS; i++){
          ss2len = PQC_NTRU768_SHAREDSECRET_SIZE;
          ret = axiocrypto_pqc_decapsulate(PQC_NTRU768, sk, sklen, ct, ctlen, ss2, &ss2len);
          if(ret != PQC_SUCCESS){
               printf("NTRU768 decapsulation failed(ret:%d)\n", ret);
               return;
          }
     }
     e = xTaskGetTickCount();
     printf("Decap:\t");
     print_elapsed_ms_ticks(s, e, NTESTS);
     printf(" | ");
     secure_stack_disp();
     printf("============================================================\n\n");

     return;
}
